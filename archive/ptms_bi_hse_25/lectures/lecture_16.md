---
title: "Теория вероятностей и математическая статистика"
subtitle: "Тестирование статистических гипотез I."
institute: "ВШБ Бизнес-информатика"
author: "Глеб Карпов"
format: 
    beamer:
        pdf-engine: xelatex
        aspectratio: 169
        fontsize: 9pt
        theme: Singapore
        fonttheme: serif
        section-titles: true
        incremental: true
        include-in-header: ../files/xeheader.tex  # Custom LaTeX commands and preamble
---

## Основы тестирования гипотез

Пусть $X_1, \ldots, X_n$ — случайная выборка независимых случайных величин $X_i$ с функцией плотности $f_X(x|\theta)$, где $\theta$ — неизвестный параметр распределения $X_i$.

Имя параметра $\theta$ — это просто общее обозначение для многих возможных вариантов, мы будем работать с параметрами $\mu$ и $p$, как и раньше.

Задача тестирования гипотез задаётся разбиением пространства параметров $\Theta$ на два непересекающихся подмножества:
$\Theta = \Theta_0 \cup \Theta_1$, $\Theta_0 \cap \Theta_1 = \emptyset$

Две гипотезы формулируются следующим образом:
$$
H_0: \theta \in \Theta_0 \qquad \quad H_1: \theta \in \Theta_1
$$

где:
\begin{itemize}
    \item $H_0$ — нулевая гипотеза
    \item $H_1$ — альтернативная гипотеза
\end{itemize}

## Процедура тестирования гипотез

Процедура тестирования гипотез определяет:
\begin{itemize}
    \item При каких значениях выборки не отклонять $H_0$
    \item При каких значениях выборки отклонять $H_0$ в пользу $H_1$
\end{itemize}

## Возможные исходы

Четыре возможных исхода в тестировании гипотез:

| Решение | $H_0$ верна | $H_0$ неверна |
|----------|---------------|----------------|
| Принять $H_0$ | правильно | Ошибка II рода |
| Отклонить $H_0$ | Ошибка I рода | правильно |

Вероятность ошибки I рода = уровень значимости ($\alpha$).

Обычно $\alpha = 0.05$

## Философские замечания

\begin{itemize}
    \item Никогда не утверждать категорично, что одна из двух гипотез верна
    \item "Принять $H_0$" на самом деле означает "Пока что не отклонять $H_0$"
    \item Одиночный эксперимент не может выступить абсолютным подтверждением гипотезы
\end{itemize}

## Гипотезы о математическом ожидании при известной дисперсии

Предположения:
\begin{enumerate}
    \item Случайная выборка $\mathcal{X} = \{X_1, \ldots, X_n\}$ из неизвестного распределения с $\mu \equiv E[X_i]$, и $\sigma^2 \equiv \text{Var }[X_i]$,
    \item Истинную дисперсию считаем известной,
    \item Либо: большая выборка ($n > 30$), либо исследуемый случайный процесс имеет нормальное распределение
\end{enumerate}

 

## Гипотезы о математическом ожидании при известной дисперсии
### Пример 1: левосторонний тест

Исследовательская команда изучает популяции жирафов. Исследователи верят, что средняя длина шеи жирафов огромная — около 20 метров. Однако в выборке было получено выборочное среднее 2.8 метров. Команда хочет проверить, действительно ли средняя длина шеи меньше того значения, в которое они верят.
\begin{itemize}
    \item Случайная величина для анализа: $X$ — длина шеи. Дисперсию $X$ предположим известной и правдивой.
    \item Предполагается, что длины шеи следуют нормальному распределению.
\end{itemize}
Данные:
\begin{itemize}
    \item Выборка: $n = 20$ жирафов
    \item Выборочное среднее: $\bar{x} = 2.8$ метров
    \item Известная дисперсия $X$: $\text{Var }[X] = 0.16$.
\end{itemize}
Гипотезы:
\begin{itemize}
    \item $H_0: \mu = 20$
    \item $H_1: \mu < 20$
\end{itemize}

## Гипотезы о математическом ожидании при известной дисперсии
### Левосторонний тест

Для тестирования $H_0: \mu = \mu_0$ против $H_1: \mu < \mu_0$:

\begin{itemize}
    \item \textit{Распределение при нулевой гипотезе}, когда мы безраздельно верим в то, что она верна: 
    \begin{equation*}
    \colorbox{red!20}{$\bar{X} \sim \mathcal{N} \left( \mu_0, \frac{\sigma^2}{n} \right)$}
    \end{equation*}

    \item Вычисление критической области:
    $$
    P_{H_0} \left( \bar{X} < K \right) = \alpha
    $$

    \item Преобразование:
    $$
    P_{H_0}(\bar{X} < K) = P_{H_0}\left(\colorbox{red!20}{$\frac{\bar{X} - \mu_0}{\frac{\sigma}{\sqrt{n}}}$} < \frac{K - \mu_0}{\frac{\sigma}{\sqrt{n}}} \right) = P(Z < z_{\alpha})
    $$

    \item Граница критической области:
    $$
    K = \mu_0 - z_{\alpha}\frac{\sigma}{\sqrt{n}}
    $$

    \item Правило принятия решения: Отклонить $H_0$, если $\bar{x} < K$
\end{itemize}

## Гипотезы о математическом ожидании при известной дисперсии
### Пример 1: решение

\begin{itemize}
    \item \textbf{Гипотезы}: $H_0: \mu = 20$ против $H_1: \mu < 20$ (левосторонний тест)
    
    \item \textbf{Данные}: $\mu_0 = 20$, $\sigma = 0.4$, $n = 20$, $\bar{x} = 2.8$, $\alpha = 0.05$
    
    \item \textbf{Критическая область}: $z_{0.05} = 1.645$
    $$
    K = 20 - 1.645 \cdot \frac{0.4}{\sqrt{20}} \approx 19.853
    $$
    
    \item \textbf{Решение}: $\bar{x} = 2.8 < K = 19.853$, поэтому отклоняем $H_0$.
    
    \item \textbf{Вывод}: Имеются достаточно статистически значимые основания для утверждения, что средняя длина шеи жирафов меньше $20$ метров. Консервативная гипотеза отклоняется в пользу альтернативной.
\end{itemize}


## Гипотезы о математическом ожидании при известной дисперсии
### Пример 2: правосторонний тест

Исследовательская команда изучает популяции жирафов. Исследователи верят, что средняя длина шеи жирафов составляет $0.5$ метра. Однако при наблюдении выборки было получено выборочное среднее $2.8$ метров. Команда хочет проверить, действительно ли средняя длина шеи больше ожидаемых $0.5$ м.
\begin{itemize}
    \item Случайная величина для анализа: $X$ — длина шеи. Дисперсия $X$ известна из предыдущих исследований.
    \item Предполагается, что длины шеи следуют нормальному распределению.
\end{itemize}
Данные:
\begin{itemize}
    \item Выборка: $n = 20$ жирафов
    \item Выборочное среднее: $\bar{x} = 2.8$ метров
    \item Известная дисперсия $X$: $\text{Var }[X] = 0.01$.
\end{itemize}
Гипотезы:
\begin{itemize}
    \item $H_0: \mu = 0.5$
    \item $H_1: \mu > 0.5$
\end{itemize}

## Гипотезы о математическом ожидании при известной дисперсии
### Правосторонний тест

Для тестирования $H_0: \mu = \mu_0$ против $H_1: \mu > \mu_0$:

\begin{itemize}
    \item \textit{Распределение при нулевой гипотезе}, когда мы безраздельно верим в то, что она верна: 
    \begin{equation*}
    \colorbox{red!20}{$\bar{X} \sim \mathcal{N} \left( \mu_0, \frac{\sigma^2}{n} \right)$}
    \end{equation*}

    \item Общая идея: отклонять $H_0$, если свидетельство $\bar{x}$ достаточно велико, \textit{т.е.} $\bar{x} > K$. Как выбрать $K$?

    \item Установление критической (решающей) границы:
    $$
    P_{H_0} \left( \bar{X} > K \right) = \alpha
    $$

    \item Преобразование:
    $$
    P_{H_0}(\bar{X} > K) = P_{H_0}\left(\colorbox{red!20}{$\frac{\bar{X} - \mu_0}{\frac{\sigma}{\sqrt{n}}}$} > \frac{K - \mu_0}{\frac{\sigma}{\sqrt{n}}} \right) = P(Z > z_{\alpha})
    $$

    \item В итоге, критическая (отклоняющая) граница:
    $$
    K = \mu_0 + z_{\alpha}\frac{\sigma}{\sqrt{n}}
    $$

    \item Правило принятия решения: Отклонить $H_0$, если $\bar{x} > K$
\end{itemize}

## Гипотезы о математическом ожидании при известной дисперсии
### Пример 2: решение

\begin{itemize}
    \item \textbf{Гипотезы}: $H_0: \mu = 0.5$ против $H_1: \mu > 0.5$ (правосторонний тест)
    
    \item \textbf{Данные}: $\mu_0 = 0.5$, $\sigma = 0.1$, $n = 20$, $\bar{x} = 2.8$, $\alpha = 0.05$
    
    \item \textbf{Критическая область}: $z_{0.05} = 1.645$
    $$
    K = 0.5 + 1.645 \cdot \frac{0.1}{\sqrt{20}} \approx 0.537
    $$
    
    \item \textbf{Решение}: $\bar{x} = 2.8 > K = 0.647$, поэтому отклоняем $H_0$.
    
    \item \textbf{Вывод}: Имеются достаточно статистически значимые основания для утверждения, что средняя длина шеи жирафов больше $0.5$ метра. Консервативная гипотеза отклоняется в пользу альтернативной.
\end{itemize}

## Гипотезы о математическом ожидании при известной дисперсии
### Пример 3: двусторонний тест

Интернет-магазин недавно переделал свой сайт для улучшения пользовательского опыта. До переделки среднее время, которое клиенты проводили на сайте, составляло 8 минут. Аналитическая команда компании знает из исторических данных, что стандартное отклонение длительности сессии составляет 2.5 минуты. Команда хочет определить, изменила ли переделка среднюю длительность сессии.

После переделки была проанализирована случайная выборка из 50 сессий клиентов, и средняя длительность сессии оказалась равной 7.2 минуты. Компании нужно определить, является ли это различие статистически значимым, так как любое изменение длительности сессии может повлиять на вовлечённость клиентов и продажи.
\begin{itemize}
    \item Случайная величина для анализа: $X$ — длительность сессии. Дисперсия $X$ известна из исторических данных.
    \item Предполагается, что длительности сессий следуют нормальному распределению.
\end{itemize}
Данные:
\begin{itemize}
    \item Выборка: $n = 50$ сессий
    \item Выборочное среднее: $\bar{x} = 7.2$ минут
    \item Известное стандартное отклонение: $\sigma = 2.5$ минут
\end{itemize}
Гипотезы:
\begin{itemize}
    \item $H_0: \mu = 8$ (переделка не изменила среднюю длительность сессии)
    \item $H_1: \mu \neq 8$ (переделка изменила среднюю длительность сессии)
\end{itemize}

## Гипотезы о математическом ожидании при известной дисперсии
### Двусторонний тест

Для тестирования $H_0: \mu = \mu_0$ против $H_1: \mu \neq \mu_0$:

\begin{itemize}
    \item \textit{Распределение при нулевой гипотезе}, когда мы безраздельно верим в то, что она верна: 
    \begin{equation*}
    \colorbox{red!20}{$\bar{X} \sim \mathcal{N} \left( \mu_0, \frac{\sigma^2}{n} \right)$}
    \end{equation*}

    \item Вычисление критической (отклоняющей) области:
    \begin{equation*}
        P_{H_0} \left( \bar{X} > K_R \right) = \frac{\alpha}{2}, \quad    P_{H_0} \left( \bar{X} < K_L \right) = \frac{\alpha}{2} \quad \text{ или } P_{H_0} \left( K_L < \bar{X} < K_R \right) = 1 - \alpha
    \end{equation*}

    \item Преобразование:
    \begin{equation*}
    P_{H_0} \left( K_L < \bar{X} < K_R \right) = P_{H_0}\left( \frac{K_L - \mu_0}{\frac{\sigma}{\sqrt{n}}} <  \colorbox{red!20}{$\frac{\bar{X} - \mu_0}{\frac{\sigma}{\sqrt{n}}}$} < \frac{K_R - \mu_0}{\frac{\sigma}{\sqrt{n}}} \right) = P( -z_{\alpha / 2} < Z < z_{\alpha / 2})
    \end{equation*}

    \item Границы критической области:
    \begin{equation*}
        z_{\alpha / 2} = \frac{K_R - \mu_0}{\frac{\sigma}{\sqrt{n}}} \rightarrow K_R = \mu_0 + z_{\alpha / 2}\frac{\sigma}{\sqrt{n}}, \quad
        -z_{\alpha / 2} = \frac{K_L - \mu_0}{\frac{\sigma}{\sqrt{n}}} \rightarrow K_L = \mu_0 - z_{\alpha / 2}\frac{\sigma}{\sqrt{n}}.
    \end{equation*}

    \item Правило принятия решения: Отклонить $H_0$, если $\bar{x} < K_L$ или если $\bar{x} > K_R$.
\end{itemize}

## Гипотезы о математическом ожидании при известной дисперсии
### Пример 3: решение

\begin{itemize}
    \item \textbf{Гипотезы}: $H_0: \mu = 8$ против $H_1: \mu \neq 8$ (двусторонний тест)
    
    \item \textbf{Данные}: $\mu_0 = 8$, $\sigma = 2.5$, $n = 50$, $\bar{x} = 7.2$, $\alpha = 0.05$
    
    \item \textbf{Критическая область}: $z_{0.025} = 1.96$
    $$
    K_L = 8 - 1.96 \cdot \frac{2.5}{\sqrt{50}} \approx 7.31, \quad K_R = 8 + 1.96 \cdot \frac{2.5}{\sqrt{50}} \approx 8.69
    $$
    
    \item \textbf{Решение}: $\bar{x} = 7.2 < K_L = 7.31$, поэтому отклоняем $H_0$.
    
    \item \textbf{Вывод}: Имеются достаточно статистически значимые основания для утверждения, что переделка сайта изменила среднюю длительность сессии. Консервативная гипотеза отклоняется в пользу альтернативной.
\end{itemize}


## Гипотезы о математическом ожидании при неизвестной дисперсии

Предположения:
\begin{enumerate}
    \item Случайная выборка $\mathcal{X} = \{X_1, \ldots, X_n\}$ из неизвестного распределения с $\mu \equiv E[X_i]$, и $\sigma^2 \equiv \text{Var }[X_i]$,
    \item Истинную дисперсию считаем неизвестной,
    \item Либо: большая выборка ($n > 30$), либо исследуемый случайный процесс имеет нормальное распределение
\end{enumerate}


## Гипотезы о математическом ожидании при неизвестной дисперсии
### Пример 5: левосторонний тест

Производственная компания внедрила новый производственный процесс и хочет проверить, уменьшилось ли среднее время производства детали относительно целевого значения 30 минут. Более быстрое производство указывало бы на успешное внедрение новой системы.
\begin{itemize}
    \item Исследуемая случайная величина: $X$ — время производства. Дисперсия $X$ неизвестна.
  \item Предполагается, что времена производства следуют нормальному распределению.
\end{itemize}
Данные:
\begin{itemize}
  \item Выборка: $n = 16$ различных произведенных деталей
  \item Выборочное среднее: $\bar{x} = 27.5$ минут
  \item Выборочное стандартное отклонение: $s = 5$ минут
\end{itemize}
Гипотезы:
\begin{itemize}
  \item $H_0: \mu = 30$
  \item $H_1: \mu < 30$
\end{itemize}

## Гипотезы о математическом ожидании при неизвестной дисперсии
### Левосторонний тест

Для тестирования $H_0: E[X] = \mu = \mu_0$ против $H_1: E[X] = \mu < \mu_0$:

\begin{itemize}
    \item \textit{Распределение при нулевой гипотезе}, когда мы безраздельно верим в то, что она верна:
    \begin{equation*}
    \colorbox{red!20}{$\bar{X} \sim \mathcal{N} \left( \mu_0, \frac{\sigma^2}{n} \right), \; \; \frac{\bar{X} - \mu_0}{\frac{S}{\sqrt{n}}} \sim t_{n-1 \; df}$}
    \end{equation*}

    \item Построение границы критической области теста относительно установленного уровня значимости:
    $$
        P_{H_0} \left( \bar{X} < K \right) = \alpha
    $$

    \item Преобразование к $t$-распределению:
    $$
    P_{H_0}(\bar{X} < K) = P_{H_0}\left(\colorbox{red!20}{$\frac{\bar{X} - \mu_0}{\frac{S}{\sqrt{n}}}$}
    < \frac{K - \mu_0}{\frac{S}{\sqrt{n}}} \right) = P(t < -t_{(n-1, \alpha)})
    $$

    \item Восстановление границы отклоняющей области:
    $$
        K = \mu_0 - t_{(n-1, \alpha)}\frac{S}{\sqrt{n}}
    $$

    \item Правило принятия решения: Отклонить $H_0$, если $\bar{x} < K$
\end{itemize}

## Гипотезы о математическом ожидании при неизвестной дисперсии
### Пример 5: решение

\begin{itemize}
    \item \textbf{Гипотезы}: $H_0: \mu = 30$ против $H_1: \mu < 30$ (левосторонний тест)
    
    \item \textbf{Данные}: $\mu_0 = 30$, $s = 5$, $n = 16$, $\bar{x} = 27.5$, $\alpha = 0.05$
    
    \item \textbf{Критическая область}: $t_{15, 0.05} = 1.753$
    $$
    K = 30 - 1.753 \cdot \frac{5}{\sqrt{16}} = 27.81
    $$
    
    \item \textbf{Решение}: $\bar{x} = 27.5 < K = 27.81$, поэтому отклоняем $H_0$.
    
    \item \textbf{Вывод}: Имеются достаточно статистически значимые основания для утверждения, что новый производственный процесс уменьшил среднее время производства детали относительно целевых 30 минут. Консервативная гипотеза отклоняется в пользу альтернативной.
\end{itemize}


## Гипотезы о доле бинарного признака
### Иначе: о вероятности успеха в схеме Бернулли

Напоминание о выборочной доле
\begin{itemize}
\item Введём $Y$ — случайную величину, показывающую количество положительных ответов в выборке, она имеет биномиальное распределение с $E[Y] = np$ и $Var[Y] = np(1-p)$.
\item Тогда $\hat{p} = \frac{Y}{n}$ — случайная величина, называемая \textit{выборочной долей} и показывающая долю положительных ответов к размеру выборки.
\item Её свойства можно вывести из $Y$, а именно: $E[\hat{p}] = p$, $Var[\hat{p}] = \frac{p(1-p)}{n}$.
\item Как следствие ИТМЛ, если $n>30$, то:
$$
   \hat{p} \sim \mathcal{N}\left(p, \frac{p(1-p)}{n} \right), \; \text { или } \frac{\hat{p} - p}{\sqrt{\frac{p(1-p)}{n}}} \sim \mathcal{N}(0,1)
$$
\end{itemize}

## Гипотезы о доле бинарного признака
### Пример 6: правосторонний тест
Компания запустила новую телевизионную рекламную кампанию и хочет проверить, выше ли уровень узнаваемости бренда, чем было исторически ранее ($40\%$).
\begin{itemize}
  \item Выборка: $n = 200$ опрошенных клиентов
  \item Реализация выборочной доли: $\tilde{p} = 0.45$ ($45\%$ узнали бренд)
\end{itemize}
Гипотезы:
\begin{itemize}
  \item $H_0: p = 0.40$ (новая кампания не более эффективна)
  \item $H_1: p > 0.40$ (новая кампания увеличивает узнаваемость бренда)
\end{itemize}

## Гипотезы о доле бинарного признака
### Правосторонний тест

Для тестирования $H_0: p = p_0$ против $H_1: p > p_0$:

\begin{itemize}
    \item \textit{Распределение при нулевой гипотезе}, когда мы безраздельно верим в то, что она верна: 
    \begin{equation*}
    \colorbox{red!20}{$\hat{p} \sim \mathcal{N} \left( p_0, \frac{p_0(1-p_0)}{n} \right)$}
    \end{equation*}

    \item Построение критической (отклоняющей) области относительно уровня значимости:
    $$
        P_{H_0} \left( \hat{p} > K \right) = \alpha
    $$

    \item Преобразование к стандартному нормальному распределению:
    $$
        P_{H_0}(\hat{p} > K) = P_{H_0}\left(\colorbox{red!20}{$\frac{\hat{p} - p_0}{\sqrt{\frac{p_0(1-p_0)}{n}}}$} > \frac{K - p_0}{\sqrt{\frac{p_0(1-p_0)}{n}}} \right) = P(Z > z_{\alpha})
    $$

    \item Восстановление границы отклоняющей области:
    $$
    K = p_0 + z_{\alpha}\sqrt{\frac{p_0(1-p_0)}{n}}
    $$

    \item Правило принятия решения: Отклонить $H_0$, если $\tilde{p} > K$
\end{itemize}

## Гипотезы о доле бинарного признака
### Пример 6: решение

\begin{itemize}
    \item \textbf{Гипотезы}: $H_0: p = 0.40$ против $H_1: p > 0.40$ (правосторонний тест)
    
    \item \textbf{Данные}: $p_0 = 0.40$, $n = 200$, $\tilde{p} = 0.45$, $\alpha = 0.05$
    
    \item \textbf{Критическая область}: $z_{0.05} = 1.645$
    $$
    K = 0.40 + 1.645 \cdot \sqrt{\frac{0.40 \cdot 0.60}{200}} \approx 0.457
    $$
    
    \item \textbf{Решение}: $\tilde{p} = 0.45 < K = 0.457$, поэтому не отклоняем $H_0$.
    
    \item \textbf{Вывод}: Результаты тестирования не предоставляют достаточных статистически значимых оснований для отклонения нулевой гипотезы. Нет достаточных оснований утверждать, что новая рекламная кампания увеличила узнаваемость бренда выше 40\%.
\end{itemize}





