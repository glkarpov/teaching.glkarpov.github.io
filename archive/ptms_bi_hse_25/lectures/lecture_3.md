---
title: "Теория вероятностей и математическая статистика"
subtitle: "Полная вероятность. Формула Байеса. Случайные величины."
institute: "ВШБ Бизнес-информатика"
author: "Глеб Карпов"
format: 
    beamer:
        pdf-engine: xelatex
        aspectratio: 169
        fontsize: 9pt
        theme: Singapore
        fonmttheme: serif
        section-titles: true
        incremental: true
        include-in-header: ../files/xeheader.tex  # Custom LaTeX commands and preamble
---

## Полная вероятность

* Концепция условной вероятности неразрывно связана со следующей, концепцией полной вероятности.

* Рассмотрим зафиксированное пространство $\left( \Omega, \mathcal{F}, P \right)$. Назовем **разбиением** $\Omega$ коллекцию событий $\{ B_k, \, k \in I \}$, таких что $B_i \cap B_j = \varnothing$ при $i \neq j$ и $\bigcup B_i = \Omega$.

* Вдобавок, рассмотрим какое-то другое событие $B$, которое пересекается с какими-то событиями из разбиения, но не обязано пересекаться со всеми.

\begin{tikzpicture}
    % Рисуем прямоугольник 10x4
    \draw[thick] (0,0) rectangle (10,4);
    
    % Разделяем на 5 вертикальных секторов (каждый шириной 2)
    \draw[thick] (2,0) -- (2,4);
    \draw[thick] (4,0) -- (4,4);
    \draw[thick] (6,0) -- (6,4);
    \draw[thick] (8,0) -- (8,4);
    
    % Заливаем секторы разными цветами
    \fill[red!20] (0,0) rectangle (2,4);
    \fill[blue!20] (2,0) rectangle (4,4);
    \fill[green!20] (4,0) rectangle (6,4);
    \fill[yellow!20] (6,0) rectangle (8,4);
    \fill[purple!20] (8,0) rectangle (10,4);
    
    % Рисуем эллипс, который пересекает все секторы кроме первого
    \draw[thick] (6,1.5) ellipse (4 and 1.5);
    
    % Подписываем секторы
    \node at (1,3.5) {$B_1$};
    \node at (3,3.5) {$B_2$};
    \node at (5,3.5) {$\ldots$};
    \node at (7,3.5) {$B_{n-1}$};
    \node at (9,3.5) {$B_n$};
    
    \node at (6.5,1) {$A$};
    \node[above] at (5,4.2) {$\Omega$};
\end{tikzpicture}

## Полная вероятность

:::{.callout-theorem}
Если $\{B_1, B_2, \ldots \,  \}$ - разбиение $\Omega$, c $P(B_i) > 0 \; \forall i$, то:

$$
    \boxed{P(A) = \sum \limits_{i} P(A|B_i) P(B_i), \, \forall A \in \mathcal{F}}   
$$

**Доказательство.** Заметим, что мы можем реконструировать событие $A$ из его частичек-пересечений со всеми $B_i$: $A = \bigcup\limits_{i} (A \cap B_i)$. Эти кусочки $\{ A \cap B_i  \}$ попарно не пересекаются, как и оригинальные элементы разбиения. Поэтому далее можем применить свойство аддитивности вероятности:

\begin{gather*}
P(A) = P \left( \bigcup\limits_{i} (A \cap B_i) \right) \\
= \sum \limits_{i} P \left(A \cap B_i \right)
= \sum \limits_{i} P(A|B_i) P(B_i)
\end{gather*}
:::

## Теорема Байеса

:::{.callout-theorem}
Пусть $\{B_1, B_2, \ldots \,  \}$ - разбиение $\Omega$, c $P(B_i) > 0 \; \forall i$. Тогда для любого события $A$, $P(A) > 0$, справедливо:

$$
    \boxed{ P(B_j|A) = \frac{P(A|B_j)P(B_j)}{\sum \limits_{i} P(A|B_i) P(B_i)} }
$$

**Доказательство.** 

Опираемся на то, что $P(X \cap Y)$ может быть выражена через разные условные вероятности:
$$
P(X \cap Y) = P(X|Y) P(Y) = P(Y|X) P(X).
$$

Применим это к условию

$$
P(B_j|A) = \frac{P(A|B_j) P(B_j)}{P(A)},
$$

где $P(A) = \sum \limits_{i} P(A|B_i) P(B_i)$ как полная вероятность.
:::

## Пример 1
\vspace{-6.5em}
Вероятность победы лошади в скачках равна $0.3$, если погода сухая, и $0.5$ если идет дождь. Прогноз погоды дает вероятность дождя $40\%$.
\begin{enumerate}
    \item Найдите вероятность победы лошади.
    \item Если вы знаете, что лошадь проиграла гонку, какова вероятность того, что погода была сухой в день скачек? (Предположим, что вы не помните!)
\end{enumerate}

## Пример 1

Вероятность победы лошади в скачках равна $0.3$, если погода сухая, и $0.5$ если идет дождь. Прогноз погоды дает вероятность дождя $40\%$.
\begin{enumerate}
    \item Найдите вероятность победы лошади.
    \item Если вы знаете, что лошадь проиграла гонку, какова вероятность того, что погода была сухой в день скачек? (Предположим, что вы не помните!)
\end{enumerate}

- $P(V) = P(V|D) P(D) + P(V|W) P(W) = 0.3 \cdot 0.6 + 0.5 \cdot 0.4 = 0.38$
- $$
P(D|\bar{V}) = \frac{P(\bar{V} | D) P(D)}{P(\bar{V})} = \frac{0.7 \cdot 0.6}{1 - 0.38} \approx 0.677
$$

## Пример 2 (False positives)

- Редкое, но опасное заболевание имеет распространенность $1$ на $10^5$ в общей популяции. Существует диагностический тест, но он несовершенен. Если у человека есть заболевание, тест положительный с вероятностью $0.9$; если нет - тест положительный с вероятностью $\frac{1}{20}$. Тест дал положительный результат. Какова вероятность того, что у человека \textbf{действительно} есть заболевание?

- Обозначим вероятности: (H = healthy, I = ill, $+$ for detected positive, $-$ for detected negative) $P(I) = 10^{-5}$, $P(+ | I) = 0.9$, $P(+ | H) = \frac{1}{20}$. Мы заинтересованы в $P(I | +)$.

- $P(+) = P(+ | I) P(I) + P(+ | H) P(H) = 0.9 \cdot 10^{-5} + 0.05 \cdot (1 - 10^{-5}) = 0.0500085$

- $$
    P(I | +) = \frac{P(+ | I) P(I)}{P(+)} = \frac{0.9 \cdot 10^{-5}}{0.0500085} \approx 0.0002 
$$

## Случайные величины: Мотивация

- Элементарный исход в общем может иметь различный характер: цвет, буква, звук и т.д. Но для более углубленного и полного анализа случайного эксперимента лучше работать с числами.
- Можем ли мы также прикрепить число к каждому элементарному исходу независимо от его природы, а затем оперировать \textbf{только} в пространстве чисел? Спойлер: это даст нам новые инструменты, которые недоступны, если мы работаем с исходами разной природы.
- Пример: игральная кость с $6$ гранями, $2$ грани желтые, $2$ грани зеленые, $2$ грани черные, без чисел - мы можем искусственно прикрепить числа $1, 2, 3$ к каждому цвету.

## Случайные величины: Формальное определение

::: {.columns}

::: {.column width="65%"}

Результирующее 'прикрепленное' число мы называем случайной величиной.

- Дискретная случайная величина $X$ в пространстве вероятностей $(\Omega, \mathcal{F}, P)$ является отображением $X: \Omega \rightarrow \mathbb{R}$, такое что:
1. Образ $X(\Omega) = \Omega_X = Im \, X$ (все возможные результаты) является счетным подмножеством $\mathbb{R}$,
2. $\{\omega \in \Omega: X(\omega) = x\} \in \mathcal{F}$, для $x \in \mathbb{R}$.

- Для упрощения мы сокращаем события вида $\{ \omega \in \Omega: X(\omega) = x \}$ до более простого вида $\{ X = x \}$.
:::

::: {.column width="35%"}
\begin{tikzpicture}[scale=0.55]
    % Рисуем квадратный блок
    \draw[thick, fill=lightgray] (0,0) rectangle (6,6);
    \node[above] at (3,6.2) {$\Omega$};
    
    % Рисуем 9 кругов в сетке 3x3 с цветовой раскраской
    % Круг 1 (левый верхний) - ЗЕЛЕНЫЙ
    \fill[green!70] (1,5) circle (0.8);
    \draw[thick] (1,5) circle (0.8);
    \node[white, font=\bfseries] at (1,5) {$\omega_1$};
    
    % Круг 2 (левый средний) - КРАСНЫЙ
    \fill[red!70] (1,3) circle (0.8);
    \draw[thick] (1,3) circle (0.8);
    \node[white, font=\bfseries] at (1,3) {$\omega_2$};
    
    % Круг 3 (левый нижний) - ОРАНЖЕВЫЙ
    \fill[orange!70] (1,1) circle (0.8);
    \draw[thick] (1,1) circle (0.8);
    \node[white, font=\bfseries] at (1,1) {$\omega_3$};
    
    % Круг 4 (средний верхний) - ЧЕРНЫЙ
    \fill[black!70] (3,5) circle (0.8);
    \draw[thick] (3,5) circle (0.8);
    \node[white, font=\bfseries] at (3,5) {$\omega_4$};
    
    % Круг 5 (средний средний) - ЗЕЛЕНЫЙ
    \fill[green!70] (3,3) circle (0.8);
    \draw[thick] (3,3) circle (0.8);
    \node[white, font=\bfseries] at (3,3) {$\omega_5$};
    
    % Круг 6 (средний нижний) - КРАСНЫЙ
    \fill[red!70] (3,1) circle (0.8);
    \draw[thick] (3,1) circle (0.8);
    \node[white, font=\bfseries] at (3,1) {$\omega_6$};
    
    % Круг 7 (правый верхний) - ЧЕРНЫЙ
    \fill[black!70] (5,5) circle (0.8);
    \draw[thick] (5,5) circle (0.8);
    \node[white, font=\bfseries] at (5,5) {$\omega_7$};
    
    % Круг 8 (правый средний) - ЧЕРНЫЙ
    \fill[black!70] (5,3) circle (0.8);
    \draw[thick] (5,3) circle (0.8);
    \node[white, font=\bfseries] at (5,3) {$\omega_8$};
    
    % Круг 9 (правый нижний) - ЗЕЛЕНЫЙ
    \fill[green!70] (5,1) circle (0.8);
    \draw[thick] (5,1) circle (0.8);
    \node[white, font=\bfseries] at (5,1) {$\omega_9$};
    
    % Целевое пространство справа
    \draw[thick] (8,1) rectangle (10,5);
    \node[above] at (9,5.2) {$\Omega_X$};
    
    % Числа в целевом пространстве
    \node at (9,4.5) {$-500$};
    \node at (9,3.5) {$-50$};
    \node at (9,2.5) {$0$};
    \node at (9,1.5) {$100$};
    
    % Стрелки от каждого цвета к соответствующим числам
    % Красные стрелки (круги 2,6) -> -500
    \draw[->, thick, red] (1.8,3) -- (8,4.5);
    \draw[->, thick, red] (3.2,1) -- (8,4.5);
    
    % Оранжевая стрелка (круг 3) -> -50
    \draw[->, thick, orange] (1.8,1) -- (8,3.5);
    
    % Зеленые стрелки (круги 1,5,9) -> 0
    \draw[->, thick, green] (1.8,5) -- (8,2.5);
    \draw[->, thick, green] (3.2,3) -- (8,2.5);
    \draw[->, thick, green] (5.2,1) -- (8,2.5);
    
    % Черные стрелки (круги 4,7,8) -> 100
    \draw[->, thick, black] (3.2,5) -- (8,1.5);
    \draw[->, thick, black] (5.2,5) -- (8,1.5);
    \draw[->, thick, black] (5.2,3) -- (8,1.5);
\end{tikzpicture}

:::

:::


## Вероятность случайной величины

- Основной оставшийся вопрос - как находить вероятности различных значений С.В.
- Мы знаем, что каждое уникальное значение С.В. привязано к какому-то событию из $\mathcal{F}$. Тогда вероятность этого события и будет вероятностью получить данное значение С.В.
- Определение. Функция вероятности дискретной случайной переменной $X$ - это функция $p_X(x): \mathbb{R} \rightarrow [0,1]$, заданная как:
$$
p_X(x) = P(X = x) = P(A), \text{ где } A = \{ \omega \in \Omega: X(\omega) = x \}
$$
- Свойства:
1. $p_X(x) \geq 0$ для $\forall x \in \Omega_X$, $p_X(x) = 0$ для $x \notin \Omega_X$
2. $\sum \limits_{x_i \in \Omega_X} p_X(x_i) = 1$.
$$
    \sum \limits_{x_i \in \Omega_X} p_X(x_i) = \sum \limits_{x_i \in \Omega_X} P \left( \{ \omega \in \Omega: X(\omega) = x_i \}  \right) = P \left( \bigcup \limits_{x_i \in \Omega_X}  \{ \omega \in \Omega: X(\omega) = x_i \} \right) = P \left( \Omega \right) = 1.
$$

## Случайные величины: Пример
\vspace{-6.5em}
Подбрасываются две монеты. Первая монета выпадает
орлом с вероятностью $0.6$, вторая с вероятностью $0.7$. 
Предположим, что результаты подбрасываний независимы, и пусть $X$ равно общему количеству выпавших орлов. Постройте дискретную случайную величину и её функцию вероятности. 

## Новое пространство вероятности

- Как и прежде, мы можем комбинировать случайные переменные в события. 
- Например, $A = \{ x_1, \ldots, x_k \}$, $x_1, \ldots, x_k \in  \Omega_X$.
- Для вычисления $P(A)$ мы используем принцип аддитивности:
$$
P(A) = P(\{X = x_1\} \cup \ldots \cup \{X = x_k \}) = \sum \limits_{i=1}^{k} P(\{X = x_i\}). 
$$

- В конечном счете, мы можем забыть о нашем оригинальном $(\Omega, \mathcal{F}, P)$, скрыть их 'под капотом' нашего случайного эксперимента. Вместо этого мы используем новое пространство $\Omega_X$ всех возможных значений С.В. и $p_X(x)$ как новую функцию вероятности.


